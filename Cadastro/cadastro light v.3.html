<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CONTAX — Gestão de Notas ME/MEI</title>
  <style>
    :root {
      --cyan: #00bcd4;
      --cyan-600: #00a6bb;
      --cyan-700: #008fa3;
      --bg: #ffffff;
      --ink: #0f172a;
      --muted: #64748b;
      --line: #e2e8f0;
      --ok: #10b981;
      --warn: #f59e0b;
      --bad: #ef4444;
      --chip: #f1f5f9;
      --shadow: 0 8px 24px rgba(2, 132, 199, 0.12);
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      background: var(--bg);
      color: var(--ink);
      font: 14px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
    }

    .topbar {
      position: sticky; top: 0; z-index: 50;
      display: flex; align-items: center; gap: 12px;
      padding: 12px 16px;
      border-bottom: 1px solid var(--line);
      background: #f8fdff;
      backdrop-filter: saturate(1.2) blur(6px);
    }
    .brand {
      display: flex; align-items: center; gap: 10px;
      font-weight: 800; letter-spacing: .8px;
    }
    .logo {
      width: 36px; height: 36px;
      border-radius: 12px;
      background: linear-gradient(135deg, var(--cyan), #7de3f1);
      box-shadow: var(--shadow);
      position: relative;
    }
    .logo:after {
      content: ""; position: absolute; inset: 5px;
      border: 3px solid white; border-right-color: transparent; border-radius: 10px;
    }
    .brand b { color: var(--cyan-700); font-size: 18px; }
    .brand small { color: var(--muted); font-weight: 600; }

    .spacer { flex: 1; }

    .nav {
      display: flex; gap: 6px; flex-wrap: wrap;
    }
    .tab {
      border: 1px solid var(--line);
      background: white;
      color: var(--ink);
      padding: 8px 12px; border-radius: 999px;
      font-weight: 600;
      cursor: pointer; user-select: none;
      transition: transform .08s ease, background .2s ease, color .2s ease, border-color .2s ease;
    }
    .tab:hover { transform: translateY(-1px); }
    .tab.active { background: var(--cyan); color: white; border-color: var(--cyan); }
    .out {
      border: 1px solid var(--line);
      background: #fff;
      padding: 8px 12px; border-radius: 12px; cursor: pointer; font-weight: 700;
    }

    .wrap { max-width: 1120px; margin: 16px auto; padding: 0 16px 32px; }

    .cards { display: grid; gap: 16px; grid-template-columns: repeat(12, 1fr); }
    .card { grid-column: span 12; background: #ffffff; border: 1px solid var(--line); border-radius: 16px; box-shadow: var(--shadow); }
    .card h3 { margin: 0; padding: 16px; border-bottom: 1px solid var(--line); font-size: 16px; }
    .card .content { padding: 16px; }

    @media (min-width: 720px) {
      .card.sm-6 { grid-column: span 6; }
      .card.sm-4 { grid-column: span 4; }
      .card.sm-8 { grid-column: span 8; }
      .card.sm-5 { grid-column: span 5; }
      .card.sm-7 { grid-column: span 7; }
    }

    form { display: grid; gap: 12px; }
    .row { display: grid; gap: 12px; }
    @media (min-width: 720px) { .row.cols-2 { grid-template-columns: 1fr 1fr; } }

    label { font-weight: 700; color: var(--muted); font-size: 12px; }
    input, select, textarea {
      width: 100%; padding: 10px 12px; border-radius: 12px; border: 1px solid var(--line);
      outline: none; background: #fff;
      font-weight: 600;
    }
    input:focus, select:focus, textarea:focus { border-color: var(--cyan); box-shadow: 0 0 0 3px rgba(0,188,212,.1); }
    button {
      border: 0; background: var(--cyan); color: white; padding: 10px 14px; border-radius: 12px; font-weight: 800; cursor: pointer;
      box-shadow: var(--shadow);
    }
    button.secondary { background: #ffffff; color: var(--cyan-700); border: 1px solid var(--cyan); }

    .muted { color: var(--muted); }
    .chips { display: flex; flex-wrap: wrap; gap: 8px; }
    .chip { font-weight: 700; background: var(--chip); border-radius: 999px; padding: 6px 10px; border: 1px solid var(--line); }

    table { width: 100%; border-collapse: collapse; }
    th, td { text-align: left; padding: 10px 8px; border-bottom: 1px solid var(--line); }
    th { font-size: 12px; color: var(--muted); text-transform: uppercase; letter-spacing: .4px; }
    tr:hover td { background: #f8fdff; }

    .kpi { display: flex; align-items: center; gap: 12px; }
    .kpi .dot { width: 12px; height: 12px; border-radius: 999px; background: var(--cyan); }
    .kpi b { font-size: 20px; }

    .progress { height: 12px; background: #e8f7fa; border-radius: 999px; overflow: hidden; border: 1px solid #d2eff5; }
    .progress > i { display: block; height: 100%; background: linear-gradient(90deg, var(--cyan), #7de3f1); width: 0%; }

    .pill { padding: 4px 10px; border-radius: 999px; font-weight: 800; font-size: 12px; border: 1px solid var(--line); }
    .pill.ok { color: #065f46; background: #ecfdf5; border-color: #d1fae5; }
    .pill.warn { color: #78350f; background: #fffbeb; border-color: #fde68a; }
    .pill.bad { color: #7f1d1d; background: #fef2f2; border-color: #fecaca; }

    .hide { display: none !important; }

    .login {
      max-width: 420px; margin: 56px auto; padding: 24px; border-radius: 16px; border: 1px solid var(--line); background: white; box-shadow: var(--shadow);
    }
    .login h1 { margin: 8px 0 0; font-size: 28px; }
    .login p { margin: 4px 0 16px; color: var(--muted); font-weight: 600; }

    .footer { text-align: center; color: var(--muted); font-size: 12px; margin: 24px 0; }

    .right { text-align: right; }

    /* Visualização de arquivos */
    .file-preview { border: 1px solid var(--line); border-radius: 12px; padding: 8px; margin-top: 8px; max-height: 300px; overflow:auto; }
    .file-preview img, .file-preview iframe, .file-preview pre { width: 100%; height: 100%; }
  </style>
</head>
<body>
  <header class="topbar">
    <div class="brand">
      
      <img class="logo" src="minhaLogo.png" alt="Logo CONTAX">

      <div>
        <div><b>CONTAX</b></div>
        <small>ME & MEI • Dashboard</small>
      </div>
    </div>
    <div class="spacer"></div>
    <nav class="nav hide" id="navTabs">
      <button class="tab active" data-tab="dashboard">Dashboard</button>
      <button class="tab" data-tab="empresas" id="tabEmpresas">Empresas</button>
      <button class="tab" data-tab="notas" id="tabNotas">Notas Fiscais</button>
    </nav>
    <div class="spacer"></div>
    <div id="who" class="muted"></div>
    <button class="out hide" id="btnLogout">Sair</button>
  </header>

  <!-- LOGIN -->
  <main class="wrap" id="screenLogin">
    <div class="login">
      <div class="brand" style="margin-bottom:8px">
        <div class="logo"></div>
        <div><b>CONTAX</b></div>
      </div>
      <h1>Bem-vindo(a)</h1>
      <p>Escolha o tipo de acesso. Área de lançamento de notas é exclusiva do administrador.</p>
      <form id="formLogin">
        <label for="role">Entrar como</label>
        <select id="role" required>
          <option value="admin">Administrador</option>
          <option value="empresa">Empresa</option>
        </select>

        <div id="loginAdmin">
          <label for="adminPass">Senha do administrador</label>
          <input id="adminPass" type="password" placeholder="Ex.: admin123" />
        </div>

        <div id="loginEmpresa" class="hide">
          <label for="empresaSelect">Selecione sua empresa</label>
          <select id="empresaSelect"></select>
          <label for="empresaPass">Senha</label>
          <input id="empresaPass" type="password" placeholder="Senha da empresa" />
        </div>

        <button type="submit">Entrar</button>
        <button type="button" class="secondary" id="btnSeed">Popular com dados de exemplo</button>
      </form>
      <div class="footer">Cores: ciano & branco • © CONTAX</div>
    </div>
  </main>

  <!-- APP -->
  <main class="wrap hide" id="screenApp">
    <!-- DASHBOARD -->
    <section id="tab-dashboard" class="cards">
      <article class="card sm-8">
        <h3>Visão Geral — <span id="monthLabel"></span></h3>
        <div class="content" id="dashboardResumo">
          <div class="muted">Nenhum dado encontrado.</div>
        </div>
      </article>
      <article class="card sm-4">
        <h3>Filtro</h3>
        <div class="content">
          <form id="formFiltro">
            <label for="mes">Mês</label>
            <input type="month" id="mes" />
            <div id="filtroEmpresaWrap">
              <label for="filtroEmpresa">Empresa</label>
              <select id="filtroEmpresa"></select>
            </div>
            <button type="submit">Aplicar</button>
          </form>
        </div>
      </article>
      <article class="card sm-12">
        <h3>Notas Fiscais do período</h3>
        <div class="content">
          <table>
            <thead>
              <tr>
                <th>Data</th>
                <th>Empresa</th>
                <th>Descrição</th>
                <th class="right">Valor (R$)</th>
              </tr>
            </thead>
            <tbody id="tNotasPeriodo"></tbody>
          </table>
        </div>
      </article>
    </section>

    <!-- EMPRESAS (ADMIN) -->
    <section id="tab-empresas" class="cards hide">
      <article class="card sm-5">
        <h3>Cadastrar Empresa</h3>
        <div class="content">
          <form id="formEmpresa">
            <div class="row cols-2">
              <div>
                <label for="nomeEmp">Nome</label>
                <input id="nomeEmp" required placeholder="Ex.: Acme LTDA" />
              </div>
              <div>
                <label for="cnpjEmp">CNPJ (opcional)</label>
                <input id="cnpjEmp" placeholder="00.000.000/0001-00" />
              </div>
            </div>
            <div class="row cols-2">
              <div>
                <label for="tipoEmp">Tipo</label>
                <select id="tipoEmp">
                  <option value="MEI">MEI</option>
                  <option value="ME">ME</option>
                </select>
              </div>
              <div>
                <label for="limiteMensal">Limite Mensal (R$)</label>
                <input id="limiteMensal" type="number" min="0" step="0.01" placeholder="Ex.: 6750 para MEI" />
              </div>
            </div>
            <div>
              <label for="senhaEmp">Senha da empresa</label>
              <input id="senhaEmp" type="password" placeholder="Defina uma senha" />
            </div>
            <button type="submit">Salvar Empresa</button>
          </form>
        </div>
      </article>

      <article class="card sm-7">
        <h3>Empresas Cadastradas</h3>
        <div class="content">
          <table>
            <thead>
              <tr>
                <th>Nome</th>
                <th>Tipo</th>
                <th>Limite Mensal</th>
                <th></th>
              </tr>
            </thead>
            <tbody id="tEmpresas"></tbody>
          </table>
        </div>
      </article>
    </section>

    <!-- NOTAS (ADMIN) -->
    <section id="tab-notas" class="cards hide">
      <article class="card sm-5">
        <h3>Lançar Nota Fiscal (apenas Admin)</h3>
        <div class="content">
          <form id="formNota">
            <label for="empresaNF">Empresa</label>
            <select id="empresaNF"></select>
            <div class="row cols-2">
              <div>
                <label for="dataNF">Data</label>
                <input id="dataNF" type="date" />
              </div>
              <div>
                <label for="valorNF">Valor (R$)</label>
                <input id="valorNF" type="number" min="0" step="0.01" />
              </div>
            </div>
            <label for="descNF">Descrição</label>
            <input id="descNF" placeholder="Serviço, venda, etc." />
            <button type="submit">Lançar Nota</button>
          </form>
        </div>
      </article>

      <article class="card sm-7">
        <h3>Notas Fiscais (todas)</h3>
        <div class="content">
          <table>
            <thead>
              <tr>
                <th>Data</th>
                <th>Empresa</th>
                <th>Descrição</th>
                <th class="right">Valor (R$)</th>
                <th></th>
              </tr>
            </thead>
            <tbody id="tNotas"></tbody>
          </table>
        </div>
      </article>
    </section>

    <!-- Importação de Arquivos -->
    <section class="cards">
      <article class="card sm-12">
        <h3>Importar Arquivos</h3>
        <div class="content">
          <input type="file" id="fileInput" multiple />
          <div id="filePreview" class="file-preview"></div>
        </div>
      </article>
    </section>
  </main>

  <script>
    /********************
     * CONTAX — Storage *
     ********************/
    const LS = {
      companiesKey: 'contax_companies',
      invoicesKey: 'contax_invoices',
      adminPassKey: 'contax_admin_pass',
      getCompanies() { return JSON.parse(localStorage.getItem(this.companiesKey) || '[]'); },
      setCompanies(list) { localStorage.setItem(this.companiesKey, JSON.stringify(list)); },
      getInvoices() { return JSON.parse(localStorage.getItem(this.invoicesKey) || '[]'); },
      setInvoices(list) { localStorage.setItem(this.invoicesKey, JSON.stringify(list)); },
      getAdminPass() { return localStorage.getItem(this.adminPassKey) || 'admin123'; },
      setAdminPass(v) { localStorage.setItem(this.adminPassKey, v); },
      resetAll() { localStorage.clear(); }
    };

    /********************
     * STATE *
     ********************/
    let state = { role: null, user: null };
    const screenLogin = document.getElementById('screenLogin');
    const screenApp = document.getElementById('screenApp');

    const navTabs = document.getElementById('navTabs');
    const who = document.getElementById('who');
    const btnLogout = document.getElementById('btnLogout');

    const loginAdmin = document.getElementById('loginAdmin');
    const loginEmpresa = document.getElementById('loginEmpresa');
    const empresaSelect = document.getElementById('empresaSelect');

    function updateEmpresaSelects() {
      const companies = LS.getCompanies();
      [empresaSelect, document.getElementById('filtroEmpresa'), document.getElementById('empresaNF')].forEach(sel => {
        sel.innerHTML = companies.map(c=>`<option value="${c.nome}">${c.nome}</option>`).join('');
      });
    }

    /********************
     * LOGIN *
     ********************/
    document.getElementById('role').addEventListener('change', e=>{
      if(e.target.value==='empresa') {
        loginAdmin.classList.add('hide');
        loginEmpresa.classList.remove('hide');
      } else {
        loginAdmin.classList.remove('hide');
        loginEmpresa.classList.add('hide');
      }
    });

    document.getElementById('formLogin').addEventListener('submit', e=>{
      e.preventDefault();
      const role = document.getElementById('role').value;
      if(role==='admin'){
        const pass = document.getElementById('adminPass').value;
        if(pass===LS.getAdminPass()){
          state = {role:'admin', user:'Administrador'};
          enterApp();
        } else { alert('Senha do administrador incorreta!'); }
      } else {
        const empresaNome = empresaSelect.value;
        const empresaPass = document.getElementById('empresaPass').value;
        const emp = LS.getCompanies().find(c=>c.nome===empresaNome);
        if(emp && emp.senha === empresaPass){
          state = {role:'empresa', user:empresaNome};
          enterApp();
        } else { alert('Empresa ou senha incorretos!'); }
      }
    });

    function enterApp(){
      screenLogin.classList.add('hide');
      screenApp.classList.remove('hide');
      navTabs.classList.remove('hide');
      btnLogout.classList.remove('hide');
      who.textContent = state.user;
      updateEmpresaSelects();
      renderEmpresas();
      renderNotas();
      renderDashboard();
      if(state.role==='empresa') {
        document.getElementById('tabEmpresas').classList.add('hide');
        document.getElementById('tabNotas').classList.add('hide');
      }
    }

    btnLogout.addEventListener('click', ()=>{
      state = {role:null, user:null};
      screenLogin.classList.remove('hide');
      screenApp.classList.add('hide');
      navTabs.classList.add('hide');
      btnLogout.classList.add('hide');
      document.getElementById('role').value='admin';
      loginAdmin.classList.remove('hide');
      loginEmpresa.classList.add('hide');
    });

    document.getElementById('btnSeed').addEventListener('click', ()=>{
      LS.resetAll();
      LS.setAdminPass('admin123');
      LS.setCompanies([
        {nome:'Acme LTDA', tipo:'ME', limite:10000, senha:'acme123'},
        {nome:'Beta MEI', tipo:'MEI', limite:6750, senha:'beta123'}
      ]);
      LS.setInvoices([
        {data:'2025-08-01', empresa:'Acme LTDA', desc:'Serviço X', valor:1200},
        {data:'2025-08-05', empresa:'Beta MEI', desc:'Produto Y', valor:600}
      ]);
      alert('Dados de exemplo populados!');
      updateEmpresaSelects();
      renderEmpresas();
      renderNotas();
      renderDashboard();
    });

    /********************
     * TABS *
     ********************/
    navTabs.querySelectorAll('.tab').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        navTabs.querySelectorAll('.tab').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        document.querySelectorAll('section[id^="tab-"]').forEach(s=>s.classList.add('hide'));
        document.getElementById('tab-'+btn.dataset.tab).classList.remove('hide');
      });
    });

    /********************
     * EMPRESAS *
     ********************/
    document.getElementById('formEmpresa').addEventListener('submit', e=>{
      e.preventDefault();
      const nome = document.getElementById('nomeEmp').value;
      const tipo = document.getElementById('tipoEmp').value;
      const limite = parseFloat(document.getElementById('limiteMensal').value) || 0;
      const senha = document.getElementById('senhaEmp').value || 'senha123';
      const companies = LS.getCompanies();
      if(companies.some(c=>c.nome===nome)){ alert('Empresa já cadastrada!'); return; }
      companies.push({nome,tipo,limite,senha});
      LS.setCompanies(companies);
      renderEmpresas();
      updateEmpresaSelects();
      e.target.reset();
    });

    function renderEmpresas(){
      const tbody = document.getElementById('tEmpresas');
      tbody.innerHTML = LS.getCompanies().map(c=>{
        return `<tr>
          <td>${c.nome}</td>
          <td>${c.tipo}</td>
          <td>R$ ${c.limite.toLocaleString('pt-BR', {minimumFractionDigits:2})}</td>
          <td class="right"><button onclick="delEmpresa('${c.nome}')">Excluir</button></td>
        </tr>`;
      }).join('');
    }

    window.delEmpresa = function(nome){
      const companies = LS.getCompanies().filter(c=>c.nome!==nome);
      LS.setCompanies(companies);
      renderEmpresas();
      updateEmpresaSelects();
    }

    /********************
     * NOTAS *
     ********************/
    document.getElementById('formNota').addEventListener('submit', e=>{
      e.preventDefault();
      const data = document.getElementById('dataNF').value;
      const empresa = document.getElementById('empresaNF').value;
      const desc = document.getElementById('descNF').value;
      const valor = parseFloat(document.getElementById('valorNF').value) || 0;
      const invoices = LS.getInvoices();
      invoices.push({data,empresa,desc,valor});
      LS.setInvoices(invoices);
      renderNotas();
      renderDashboard();
      e.target.reset();
    });

    function renderNotas(){
      const invoices = LS.getInvoices();
      const tbodyAll = document.getElementById('tNotas');
      const tbodyPer = document.getElementById('tNotasPeriodo');
      tbodyAll.innerHTML = invoices.map(n=>{
        return `<tr>
          <td>${n.data}</td>
          <td>${n.empresa}</td>
          <td>${n.desc}</td>
          <td class="right">${n.valor.toLocaleString('pt-BR',{minimumFractionDigits:2})}</td>
        </tr>`;
      }).join('');

      const mesSel = document.getElementById('mes')?.value;
      tbodyPer.innerHTML = invoices.filter(n=>{
        if(!mesSel) return true;
        return n.data.startsWith(mesSel);
      }).map(n=>{
        return `<tr>
          <td>${n.data}</td>
          <td>${n.empresa}</td>
          <td>${n.desc}</td>
          <td class="right">${n.valor.toLocaleString('pt-BR',{minimumFractionDigits:2})}</td>
        </tr>`;
      }).join('');
    }

    /********************
     * DASHBOARD *
     ********************/
    function renderDashboard(){
      const invoices = LS.getInvoices();
      const resumo = document.getElementById('dashboardResumo');
      if(invoices.length===0) { resumo.innerHTML = '<div class="muted">Nenhum dado encontrado.</div>'; return; }
      const total = invoices.reduce((a,b)=>a+b.valor,0);
      resumo.innerHTML = `<div class="kpi"><div class="dot"></div> <b>R$ ${total.toLocaleString('pt-BR',{minimumFractionDigits:2})}</b> total lançado</div>`;
      document.getElementById('monthLabel').textContent = new Date().toLocaleString('pt-BR',{month:'long',year:'numeric'});
    }

    /********************
     * FILTRO *
     ********************/
    document.getElementById('formFiltro')?.addEventListener('submit', e=>{
      e.preventDefault();
      renderNotas();
    });

    /********************
     * IMPORTAR ARQUIVOS *
     ********************/
    document.getElementById('fileInput').addEventListener('change', e=>{
      const files = Array.from(e.target.files);
      const preview = document.getElementById('filePreview');
      preview.innerHTML = '';
      files.forEach(f=>{
        const ext = f.name.split('.').pop().toLowerCase();
        if(['png','jpg','jpeg','gif'].includes(ext)){
          const img = document.createElement('img');
          img.src = URL.createObjectURL(f);
          preview.appendChild(img);
        } else if(ext==='pdf'){
          const iframe = document.createElement('iframe');
          iframe.src = URL.createObjectURL(f);
          preview.appendChild(iframe);
        } else {
          const reader = new FileReader();
          reader.onload = function(ev){
            const pre = document.createElement('pre');
            pre.textContent = ev.target.result;
            preview.appendChild(pre);
          }
          reader.readAsText(f);
        }
      });
    });

    updateEmpresaSelects();
  </script>
</body>
</html>
